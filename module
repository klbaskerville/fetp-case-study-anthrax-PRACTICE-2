import { useState } from 'react';
import { ChevronRight, ChevronLeft, BookOpen, CheckCircle, AlertCircle } from 'lucide-react';

const AnthraxCaseStudy = () => {
  const [currentSection, setCurrentSection] = useState(0);
  const [answers, setAnswers] = useState({});
  const [completedSections, setCompletedSections] = useState(new Set());

  const sections = [
    {
      id: 'intro',
      title: 'Introduction & Learning Objectives',
      content: (
        <div className="space-y-4">
          <h2 className="text-2xl font-bold text-blue-900">Anthrax in the Cattle-Keeping Corridor of Uganda: A One Health Case Study</h2>
          
          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <h3 className="font-semibold text-lg mb-2 text-blue-900">Learning Objectives</h3>
            <p className="mb-2">After completing this case study, you should be able to:</p>
            <ul className="list-disc ml-6 space-y-1">
              <li>Describe the usual sequence of steps of the outbreak investigation, and how they might differ when investigating a zoonotic disease outbreak</li>
              <li>Define the One Health approach and its relevance to preventing and responding to zoonotic disease outbreaks</li>
              <li>List the multi-disciplinary team members required to effectively investigate and respond to a zoonotic disease outbreak, and describe the roles of each</li>
              <li>Calculate attack rates to identify possible exposures causing disease</li>
              <li>Identify strategies for joint control of disease in animals and people in the context of a zoonotic disease outbreak</li>
              <li>Describe challenges that can limit effective multisectoral coordination for outbreak investigation and control of zoonotic diseases</li>
            </ul>
          </div>

          <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-300">
            <p className="text-sm italic">This case study is based on investigations undertaken in 2018 by the Ugandan Public Health Fellowship Program and was developed by Ausvet and the Australian National University in 2019.</p>
          </div>
        </div>
      )
    },
    {
      id: 'partA1',
      title: 'Part A: Initial Report',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">20th April 2018</h3>
          
          <div className="bg-gray-50 p-4 rounded-lg">
            <p className="mb-3">On Friday 20th April 2018, seven people presented to a health centre in Kween District, Uganda with swollen skin blisters and lesions with black tissue in the centre.</p>
            
            <p className="mb-3">The attending clinician, Dr. K, was concerned by the number of patients with the same clinical features. In response, Dr. K called the Kween District Health Officer.</p>
            
            <p className="mb-3">Dr. K reported that all patients lived in the village of Kaplobotwo (subcounty Ngenge, Kween District, Uganda). Six patients were males between the ages of 14 and 62; one was a three-year-old female.</p>
            
            <p className="font-semibold">All seven had been involved in skinning, butchering, carrying or eating a cow that had died suddenly on 11th April in Kaplobotwo.</p>
          </div>

          <QuestionBox
            number={1}
            question="Would you call this an outbreak? Why or why not?"
            answerId="q1"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partA2',
      title: 'Part A: Setting',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Setting</h3>
          
          <div className="bg-gray-50 p-4 rounded-lg space-y-3">
            <p>Kaplobotwo is located in Kween district, a mountainous area that is part of the 'cattle-keeping corridor' of Uganda. Kween shares a border with the Republic of Kenya to the south. Road access is limited to some areas of the district.</p>
            
            <div className="grid md:grid-cols-2 gap-4">
              <div className="bg-white p-3 rounded">
                <h4 className="font-semibold mb-2">District Demographics</h4>
                <ul className="text-sm space-y-1">
                  <li>• ~85% depend on subsistence farming</li>
                  <li>• Over 80% raise livestock</li>
                  <li>• ~100,000 people total</li>
                  <li>• Over half are under 18 years</li>
                  <li>• ~1/3 are illiterate</li>
                  <li>• <2% own television</li>
                  <li>• ~50% own radio (main info source)</li>
                </ul>
              </div>
              
              <div className="bg-white p-3 rounded">
                <h4 className="font-semibold mb-2">Kaplobotwo Village</h4>
                <ul className="text-sm space-y-1">
                  <li>• 234 residents</li>
                  <li>• 127 males</li>
                  <li>• 138 under 18 years old</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      )
    },
    {
      id: 'partA3',
      title: 'Part A: Field Investigation Begins',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">21st April 2018</h3>
          
          <div className="bg-gray-50 p-4 rounded-lg space-y-3">
            <p>The Kween District Health Officer immediately called a meeting with the District Rapid Response Team (RRT), which included a fellow in Uganda's Field Epidemiology Training Programme (FETP).</p>
          </div>

          <QuestionBox
            number={2}
            question="Keeping in mind that all seven index cases were involved in butchering or eating a cow, which government agencies might be interested in participating in the investigation? What types of staff might be part of a field investigation team?"
            answerId="q2"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-blue-50 p-4 rounded-lg mt-4">
            <h4 className="font-semibold mb-2">The RRT Team Composition:</h4>
            <ul className="list-disc ml-6 space-y-1">
              <li>FETP fellow</li>
              <li>Health promotion officer</li>
              <li>Laboratory technician</li>
              <li>District veterinary officer</li>
              <li>Two environmental health officers</li>
              <li>District Administrator</li>
            </ul>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg mt-4">
            <p className="mb-2">On 21st April, the RRT met with the District Health Officer, then travelled to Ngenge to start the field investigation.</p>
            <p className="mb-2">The team met with the village leader who reported that the cow had died suddenly and was butchered shortly afterwards. In total, <strong>15 Kaplobotwo residents</strong> were involved in butchering the cow and carrying its meat.</p>
            <p>Additional residents ate some of the meat. Some meat was also sold to neighbouring villages.</p>
          </div>
        </div>
      )
    },
    {
      id: 'partA4',
      title: 'Part A: Diagnosis & Investigation Steps',
      content: (
        <div className="space-y-4">
          <div className="bg-gray-50 p-4 rounded-lg">
            <p className="mb-3">The RRT visited the Ngenge health centre and met with Dr. K, who provided clinical case notes for review.</p>
            <p className="mb-3">The <strong>presumptive diagnosis was anthrax</strong>, given the patients' characteristic skin lesions, reported contact with a cow that had died suddenly, and a history of anthrax outbreaks in the region.</p>
          </div>

          <QuestionBox
            number={3}
            question="a. What was the likely source of infection for the human cases?
b. What was the likely source of infection for the cow?"
            answerId="q3"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-white border border-gray-300 p-4 rounded-lg mt-4">
            <h4 className="font-semibold mb-3">Steps of an Outbreak Investigation</h4>
            <ol className="list-decimal ml-6 space-y-2">
              <li>Identify your team/prepare for field work (Done)</li>
              <li>Establish the existence of an outbreak (in progress)</li>
              <li>Verify the diagnosis</li>
              <li>Construct a working case definition</li>
              <li>Find cases and develop line listing</li>
              <li>Perform descriptive epidemiology</li>
              <li className="font-bold text-red-600">??? (Missing step)</li>
              <li>Evaluate hypotheses through analytical studies</li>
              <li>As necessary, reconsider, refine and re-evaluate hypotheses</li>
              <li>Compare and reconcile with laboratory and/or environmental studies</li>
              <li>Implement control and prevention measures (as early as possible)</li>
              <li>Initiate or maintain surveillance</li>
              <li>Communicate findings</li>
            </ol>
          </div>

          <QuestionBox
            number={4}
            question="Which step is missing from the outbreak investigation steps above?"
            answerId="q4"
            answers={answers}
            setAnswers={setAnswers}
          />

          <QuestionBox
            number={5}
            question="From a public health perspective, which steps might be approached differently in a zoonotic disease investigation?"
            answerId="q5"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partA5',
      title: 'Part A: Case Definitions',
      content: (
        <div className="space-y-4">
          <div className="bg-gray-50 p-4 rounded-lg">
            <p className="mb-3">To verify the suspected diagnosis, the laboratory technician recommended collecting samples from the skin lesions and testing them for anthrax. Specimens from all seven patients were collected and sent to the National Reference Laboratory in Kampala for PCR testing.</p>
          </div>

          <QuestionBox
            number={6}
            question="How does an outbreak case definition differ from a standard surveillance case definition?"
            answerId="q6"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mt-4">
            <h4 className="font-semibold mb-3 text-blue-900">Human Case Definitions Developed:</h4>
            
            <div className="space-y-3">
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Suspected cutaneous anthrax case:</p>
                <p className="text-sm">Onset of itching, reddening or swelling of skin areas and any of the following: skin lesions (e.g. papule, vesicle or eschar) or lymphadenopathy</p>
              </div>
              
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Suspected gastrointestinal anthrax case:</p>
                <p className="text-sm">Onset of abdominal pain and any of the following: diarrhea, vomiting, lymphadenopathy, pharyngitis, or oropharyngeal lesions</p>
              </div>
              
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Confirmed anthrax case:</p>
                <p className="text-sm">A suspected case with PCR-positivity for Bacillus anthracis from a clinical sample</p>
              </div>
              
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Time & Place criteria:</p>
                <p className="text-sm">Onset from 6th April onwards in a person residing in Kaplobotwo village, Kween District</p>
              </div>
            </div>
          </div>

          <QuestionBox
            number={7}
            question="What are some ways you might look for additional cases (active case finding) among humans?"
            answerId="q7"
            answers={answers}
            setAnswers={setAnswers}
          />

          <QuestionBox
            number={8}
            question="What are the advantages of using a disease-specific case investigation form as part of active case finding?"
            answerId="q8"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partA6',
      title: 'Part A: Parallel Investigations',
      content: (
        <div className="space-y-4">
          <div className="bg-gray-50 p-4 rounded-lg space-y-3">
            <p>The FETP fellow identified <strong>five additional possible cases</strong> through speaking with community leaders, bringing the total to 12 suspected cases.</p>
            
            <p>Meanwhile, parallel activities were underway:</p>
            
            <div className="bg-white p-3 rounded mt-2">
              <h4 className="font-semibold mb-2">Human Health Team:</h4>
              <ul className="list-disc ml-6 text-sm space-y-1">
                <li>RRT members interviewed 12 suspected case-patients using case investigation forms</li>
                <li>Health promotion officer met with community health workers</li>
                <li>Started community engagement and mobilization</li>
                <li>Learned about community practices and beliefs</li>
                <li>Trained community health workers on anthrax prevention education</li>
              </ul>
            </div>
            
            <div className="bg-white p-3 rounded mt-2">
              <h4 className="font-semibold mb-2">Animal Health Team:</h4>
              <ul className="list-disc ml-6 text-sm space-y-1">
                <li>District veterinary officer and team visited the cow owner</li>
                <li>Decontaminated death site and butchering site with formalin (10%)</li>
                <li>Vaccinated all livestock with access to these sites</li>
                <li>Advised owner on managing anthrax risk</li>
                <li>Notified neighboring livestock owners</li>
                <li>Vaccinated at-risk livestock</li>
                <li>Asked owners to monitor animals and report sudden deaths</li>
              </ul>
            </div>
          </div>

          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mt-4">
            <h4 className="font-semibold mb-3 text-blue-900">Cattle Case Definitions:</h4>
            
            <div className="space-y-2">
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Suspected anthrax cattle case:</p>
                <p className="text-sm">Sudden death, or death within 24 hours of illness onset, with or without blood-stained discharges from external orifices, in cattle in Kaplobotwo village from 6th April onwards</p>
              </div>
              
              <div className="bg-white p-3 rounded">
                <p className="font-semibold">Confirmed anthrax cattle case:</p>
                <p className="text-sm">A suspected cattle case with Bacillus anthracis identified in clinical sample by bacterial culture, PCR or microscopic examination</p>
              </div>
            </div>
          </div>

          <QuestionBox
            number={9}
            question="How might information from the animal investigation help the human investigation (and vice versa)?"
            answerId="q9"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partA7',
      title: 'Part A: Timeline of Events',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Key Events Timeline</h3>
          
          <div className="bg-white border border-gray-300 rounded-lg p-4">
            <div className="space-y-3">
              <TimelineEntry date="11th April" event="Cow dies suddenly, is butchered and eaten in Kaplobotwo village" />
              <TimelineEntry date="20th April" event="Seven people present sick to the Ngenge III health centre, Dr. K calls district health officer" />
              <TimelineEntry date="21st April" event="Rapid response team starts field investigation, learns about history of exposure of cases to dead cow. Anthrax suspected." />
              <TimelineEntry date="22nd April" event="" empty={true} />
              <TimelineEntry date="23rd April" event="" empty={true} />
              <TimelineEntry date="29th April" event="" empty={true} />
              <TimelineEntry date="30th April" event="" empty={true} />
            </div>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg space-y-3">
            <h4 className="font-semibold">22nd April 2018</h4>
            <p>In a meeting of the RRT, the district veterinary officer reported that <strong>another cow died suddenly</strong> in the same area where the first cow died.</p>
            <p>A blood sample was taken and sent to the National Reference Laboratory for PCR testing. Under supervision, the carcass was buried to minimise potential for infection and environmental contamination. The death site was decontaminated.</p>
            <p>The FETP fellow worked with neighbouring village leaders to arrange training for community health workers in active case finding, as meat and live animals may have moved from Kaplobotwo to neighbouring villages.</p>
            <p>Environmental health officers advised on environmental routes of transmission, including soil conditions, waterways, and wildlife.</p>
          </div>

          <QuestionBox
            number={10}
            question="What key information from 22nd, 23rd-29th, and 30th April would you add to the timeline? (The actual events are described in the sections below)"
            answerId="q10"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-gray-50 p-4 rounded-lg space-y-3 mt-4">
            <h4 className="font-semibold">23rd – 29th April 2018</h4>
            <p>On 23rd April, <strong>seven additional cows</strong> were found dead in a neighbouring area — one on a pasture, six in a nearby water stream and surrounding bushes.</p>
            <p>On 29th April, <strong>another cow</strong> was found dead in Kaplobotwo.</p>
            <p>Samples were collected with appropriate carcass management. Further interviews were conducted with livestock owners about management practices.</p>
            <p>Upon receiving <strong>positive laboratory test results for B. anthracis</strong> from cattle samples, the district veterinary officer reported confirmed cases to the RRT and the Ministry of Agriculture, Animal Industry and Fisheries.</p>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg space-y-3 mt-4">
            <h4 className="font-semibold">30th April 2018</h4>
            <p>By 30th April, <strong>26 suspected human cases</strong> had been identified and interviewed. All 26 reported onset of symptoms after contact with the cow that died on 11th April.</p>
            <p><strong>Only 10 of the 26 cases had sought care</strong> at the health centre. Low care-seeking may have been related to a recent Marburg virus outbreak (October 2017), after which some community members began to fear going to the health centre (fears of dying, being sprayed with disinfectant, home quarantine, and stigmatization).</p>
          </div>
        </div>
      )
    },
    {
      id: 'partB1',
      title: 'Part B: Cohort Study',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Part B — Describing the Data</h3>
          
          <div className="bg-gray-50 p-4 rounded-lg space-y-3">
            <p>The obvious hypothesis was that the outbreak resulted from exposure to the cow that died on 11th April. The team decided to conduct a <strong>cohort study</strong> to obtain more information on possible risk factors.</p>
            
            <div className="bg-white p-3 rounded">
              <h4 className="font-semibold mb-2">Cohort Study Details:</h4>
              <ul className="list-disc ml-6 text-sm space-y-1">
                <li>Visited all 57 households in the village</li>
                <li>141 people from 57 households responded (out of 234 total residents)</li>
                <li>Non-response reasons: absence from village (boarding school, travel for trade/farming)</li>
                <li>Data collected: demographics, clinical symptoms, exposures</li>
              </ul>
            </div>
            
            <p className="font-semibold">During the cohort study, an additional 22 cases were identified, for a total of <span className="text-red-600">48 cases from Kaplobotwo</span>.</p>
            <ul className="list-disc ml-6">
              <li>45 cases met the suspected case definition</li>
              <li>3 cases met the confirmed case definition</li>
            </ul>
          </div>

          <QuestionBox
            number={11}
            question="How would you analyse the data on demographics, clinical symptoms, and exposures?"
            answerId="q11"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partB2',
      title: 'Part B: Clinical Features & Epidemic Curve',
      content: (
        <div className="space-y-4">
          <div className="bg-white border border-gray-300 rounded-lg p-4">
            <h4 className="font-semibold mb-3">Distribution of Cases by Clinical Presentation</h4>
            <table className="w-full text-sm">
              <thead className="bg-gray-100">
                <tr>
                  <th className="p-2 text-left">Type of anthrax presentation</th>
                  <th className="p-2 text-right">Number of cases</th>
                  <th className="p-2 text-right">Percentage (%)</th>
                </tr>
              </thead>
              <tbody>
                <tr className="border-t">
                  <td className="p-2">Cutaneous only</td>
                  <td className="p-2 text-right">14</td>
                  <td className="p-2 text-right">29</td>
                </tr>
                <tr className="border-t">
                  <td className="p-2">Gastrointestinal only</td>
                  <td className="p-2 text-right">14</td>
                  <td className="p-2 text-right">29</td>
                </tr>
                <tr className="border-t">
                  <td className="p-2">Cutaneous and gastrointestinal</td>
                  <td className="p-2 text-right">20</td>
                  <td className="p-2 text-right">42</td>
                </tr>
                <tr className="border-t bg-blue-50 font-semibold">
                  <td className="p-2">Total cases</td>
                  <td className="p-2 text-right">48</td>
                  <td className="p-2 text-right">100</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg">
            <h4 className="font-semibold mb-3">Epidemic Curve</h4>
            <EpidemicCurve />
            <p className="text-xs text-gray-600 mt-2 italic">Figure: Human cases (red bars) and cattle deaths (hatched bars) by date, Kaplobotwo, April 2018</p>
          </div>

          <QuestionBox
            number={12}
            question="Add arrows to the epidemic curve to indicate: (1) Cow dies and is butchered (11th April), (2) First cases present to health center (20th April), (3) RRT starts investigation (21st April). What do you notice about the timing?"
            answerId="q12"
            answers={answers}
            setAnswers={setAnswers}
          />

          <QuestionBox
            number={13}
            question="Interpret the epidemic curve. What does the shape tell you about the outbreak? What about the timing of human cases relative to cattle deaths?"
            answerId="q13"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partB3',
      title: 'Part B: Attack Rate Calculations',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Calculate Attack Rates</h3>
          
          <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-300 mb-4">
            <p className="font-semibold mb-2">Remember:</p>
            <p className="text-sm">Attack Rate = (Number of cases / Population at risk) × 100</p>
          </div>

          <AttackRateTable
            title="Attack rates by sex"
            rows={[
              { label: 'Males', cases: '', population: '127', rate: '' },
              { label: 'Females', cases: '', population: '107', rate: '' }
            ]}
            answerId="q14a"
            answers={answers}
            setAnswers={setAnswers}
          />

          <AttackRateTable
            title="Attack rates by age group"
            rows={[
              { label: '0-4', cases: '', population: '41', rate: '' },
              { label: '5-10', cases: '', population: '41', rate: '' },
              { label: '11-17', cases: '', population: '56', rate: '' },
              { label: '18-34', cases: '', population: '45', rate: '' },
              { label: '35-54', cases: '', population: '39', rate: '' },
              { label: '≥55', cases: '', population: '12', rate: '' }
            ]}
            answerId="q14b"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <p className="text-sm mb-2">Hint: Use the line list data in the appendix to count cases by sex and age group!</p>
            <details className="text-sm">
              <summary className="cursor-pointer font-semibold">View Line List Data</summary>
              <div className="mt-2 bg-white p-3 rounded max-h-64 overflow-y-auto">
                <LineListData />
              </div>
            </details>
          </div>

          <QuestionBox
            number={14}
            question="After calculating attack rates, what patterns do you observe? Which groups appear to be at highest risk?"
            answerId="q14"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partB4',
      title: 'Part B: Exposure Analysis',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Exposure-Specific Attack Rates</h3>
          
          <ExposureAttackRateTable
            answerId="q15"
            answers={answers}
            setAnswers={setAnswers}
          />

          <QuestionBox
            number={15}
            question="Based on the attack rates for different exposures, which activities appear to pose the highest risk for cutaneous anthrax? Why might some exposures have higher attack rates than others?"
            answerId="q15"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-gray-50 p-4 rounded-lg space-y-3 mt-4">
            <h4 className="font-semibold">Meat Distribution Investigation</h4>
            <p>The district veterinary officer traced meat from the implicated cow to buyers in two nearby villages:</p>
            
            <div className="grid md:grid-cols-2 gap-4 mt-3">
              <div className="bg-white p-3 rounded border border-gray-300">
                <h5 className="font-semibold text-blue-900">Tukumo Village</h5>
                <p className="text-sm mt-2">~23 people ate cooked meat in a bar</p>
                <p className="text-sm font-semibold text-green-600">No one became sick</p>
              </div>
              
              <div className="bg-white p-3 rounded border border-gray-300">
                <h5 className="font-semibold text-blue-900">Rikwo Village</h5>
                <p className="text-sm mt-2">28 people ate cooked meat in a bar - none became sick</p>
                <p className="text-sm mt-1">2 people bought meat directly from seller</p>
                <p className="text-sm font-semibold text-red-600">Both became sick (ate roasted meat)</p>
              </div>
            </div>
            
            <div className="bg-blue-50 p-3 rounded border border-blue-200 mt-3">
              <p className="text-sm"><strong>Key finding:</strong> Bar owners boiled meat for a long time, which may have destroyed anthrax spores. Roasting may not have been sufficient, as spores are resistant to dry heat.</p>
              <p className="text-sm mt-2"><strong>Analysis result:</strong> Boiling meat for >60 minutes was protective (RR=0.49 compared to <60 minutes)</p>
            </div>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg mt-4">
            <h4 className="font-semibold mb-2">Animal Investigation Findings</h4>
            <p className="mb-2">Over <strong>150 suspected anthrax cases in cattle</strong> occurred since 1st January 2018 in Ngenge subcounty.</p>
            <p className="mb-2"><strong>None of the interviewed livestock owners had vaccinated their animals</strong> against anthrax.</p>
            <p className="text-sm">Reasons: Government did not subsidise vaccination, vaccines too expensive, complex decision-making for group/family-owned animals</p>
          </div>

          <QuestionBox
            number={16}
            question="Why might some livestock owners with sick animals not come forward during an outbreak? How can reporting and compliance be improved?"
            answerId="q16"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partC',
      title: 'Part C: Response & Control Measures',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Part C — Response</h3>
          
          <div className="bg-gray-50 p-4 rounded-lg">
            <h4 className="font-semibold mb-3">Investigation Findings Summary (30th April)</h4>
            <ul className="list-disc ml-6 space-y-2 text-sm">
              <li>Human cases started 13th April 2018 from Kaplobotwo village</li>
              <li>48 total human cases identified (26 through surveillance/case finding, 22 through cohort study)</li>
              <li>Most likely cause: anthrax (based on symptoms, association with cattle, lab findings)</li>
              <li>First suspected cattle case: 11th April 2018</li>
              <li>10 cattle suspected/confirmed to have died of anthrax in Kaplobotwo during investigation</li>
              <li>Over 150 suspected cattle anthrax cases from 1st January to 30th April in Ngenge subcounty</li>
              <li>Livestock in affected area were not routinely vaccinated</li>
            </ul>
          </div>

          <QuestionBox
            number={17}
            question="Based on the findings of the outbreak investigation, what short-term and longer-term actions and control measures might you undertake? Consider measures for both human and animal health."
            answerId="q17"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mt-4">
            <p className="mb-2">Control measures are vital and should be implemented as soon as possible. However, it's important to understand the context when planning, implementing and evaluating control measures.</p>
          </div>

          <QuestionBox
            number={18}
            question="What are some possible cultural and contextual challenges associated with the proposed control measures, and other factors that are important to consider?"
            answerId="q18"
            answers={answers}
            setAnswers={setAnswers}
          />

          <QuestionBox
            number={19}
            question="Considering a One Health approach to outbreak investigation and disease control, what challenges can limit effective multisectoral collaboration?"
            answerId="q19"
            answers={answers}
            setAnswers={setAnswers}
          />
        </div>
      )
    },
    {
      id: 'partD',
      title: 'Part D: Conclusion & One Health',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Part D — Conclusion</h3>
          
          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <p className="mb-3">This outbreak of anthrax in animals and people in the 'cattle-keeping corridor' of Uganda highlights the need for <strong>coordinated investigations and response by public and animal health authorities</strong> for suspected zoonotic disease outbreaks.</p>
            
            <p className="mb-3">This case study highlights how a <strong>One Health approach</strong> can improve the effectiveness of the response.</p>
            
            <p className="mb-3">In this outbreak, all human cases were linked to exposure to a single cow death. Community health education campaigns and appropriate management of infected carcasses subsequent to the index cow death may have contributed to <strong>preventing further human anthrax cases</strong>, as no human cases were linked to subsequent cow deaths.</p>
            
            <p>Vaccination of susceptible animals in the area is likely to have also helped prevent cases in cattle.</p>
          </div>

          <div className="bg-green-50 p-4 rounded-lg border border-green-300 mt-4">
            <h4 className="font-semibold text-green-900 mb-2">Outcome:</h4>
            <p>Based on what they learned from working together in a multidisciplinary team, the outbreak team decided to form a <strong>Kween District One Health taskforce</strong> to focus on improving information sharing between animal and human health to support the prevention of, detection of and response to zoonotic disease outbreaks in Kween district in the future.</p>
          </div>

          <div className="bg-white border border-gray-300 rounded-lg p-4 mt-4">
            <h4 className="font-semibold mb-3">One Health Approach - Key Concepts</h4>
            
            <div className="space-y-3 text-sm">
              <div>
                <p className="font-semibold text-blue-900">Definition (CDC):</p>
                <p className="italic">"A collaborative, multisectoral, and transdisciplinary approach — working at the local, regional, national, and global levels — with the goal of achieving optimal health outcomes recognizing the interconnection between people, animals, plants, and their shared environment."</p>
              </div>
              
              <div>
                <p className="font-semibold text-blue-900">Why One Health matters:</p>
                <ul className="list-disc ml-6 mt-1">
                  <li>~60% of infectious diseases in humans are zoonotic</li>
                  <li>~70% of emerging infectious diseases are zoonotic</li>
                  <li>Early detection in animals can prevent human transmission</li>
                  <li>Control in animals may be most effective for preventing human disease</li>
                </ul>
              </div>
              
              <div>
                <p className="font-semibold text-blue-900">Relevant professions:</p>
                <ul className="list-disc ml-6 mt-1">
                  <li>Public health epidemiologists</li>
                  <li>Veterinary epidemiologists</li>
                  <li>Clinicians, pathologists, nurses, community health workers</li>
                  <li>Veterinarians, animal health workers, quarantine officers</li>
                  <li>Laboratory technicians</li>
                  <li>Environmental scientists, ecologists, wildlife biologists</li>
                  <li>Plus: politicians, economists, sociologists, security personnel</li>
                </ul>
              </div>
            </div>
          </div>

          <div className="bg-gray-50 p-4 rounded-lg mt-4">
            <h4 className="font-semibold mb-3">Anthrax Quick Facts</h4>
            <div className="grid md:grid-cols-2 gap-4 text-sm">
              <div>
                <p className="font-semibold">Causative agent:</p>
                <p>Bacillus anthracis (bacteria)</p>
                
                <p className="font-semibold mt-2">Key characteristic:</p>
                <p>Not contagious between live animals/humans. Forms environmentally-resistant spores in soil.</p>
                
                <p className="font-semibold mt-2">In animals:</p>
                <p>Sudden death in cattle, sheep, goats; blood from orifices. Pigs more resistant.</p>
              </div>
              
              <div>
                <p className="font-semibold">Human forms:</p>
                <ul className="list-disc ml-6">
                  <li><strong>Cutaneous:</strong> skin lesions with black eschar (1-7 days incubation)</li>
                  <li><strong>Gastrointestinal:</strong> from eating infected meat (3-7 days)</li>
                  <li><strong>Inhalational:</strong> from breathing spores (1-7 days)</li>
                </ul>
                
                <p className="font-semibold mt-2">Prevention:</p>
                <p>Livestock vaccination, proper carcass disposal, cook meat thoroughly (boil >60 min), decontaminate sites</p>
              </div>
            </div>
          </div>
        </div>
      )
    },
    {
      id: 'review',
      title: 'Review & Reflection',
      content: (
        <div className="space-y-4">
          <h3 className="text-xl font-bold text-blue-900">Case Study Review</h3>
          
          <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <h4 className="font-semibold mb-3">Reflect on what you've learned:</h4>
            <ul className="list-disc ml-6 space-y-2">
              <li>How did the investigation steps differ for this zoonotic disease compared to a purely human disease outbreak?</li>
              <li>What was the value of having multiple sectors (human health, animal health, environmental health) working together?</li>
              <li>How did understanding the community context influence control measures?</li>
              <li>What were the key epidemiological findings that guided the response?</li>
            </ul>
          </div>

          <QuestionBox
            number={20}
            question="Final Reflection: What were the three most important lessons you learned from this case study? How will you apply these lessons in your own field epidemiology practice?"
            answerId="q20"
            answers={answers}
            setAnswers={setAnswers}
          />

          <div className="bg-green-50 p-4 rounded-lg border border-green-300 mt-6">
            <h4 className="font-semibold text-green-900 mb-2">Congratulations!</h4>
            <p>You've completed the Anthrax in Uganda: A One Health Case Study.</p>
            <p className="mt-2 text-sm">Remember: Effective outbreak investigation requires coordination across sectors, understanding of local context, and timely action based on epidemiological evidence.</p>
          </div>

          <div className="flex justify-center mt-6">
            <button
              onClick={() => {
                const responses = Object.entries(answers).length;
                alert(`You've provided responses to ${responses} questions throughout this case study. Review your answers and discuss with your instructor!`);
              }}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
            >
              View Summary of Responses
            </button>
          </div>
        </div>
      )
    }
  ];

  const handleNext = () => {
    if (currentSection < sections.length - 1) {
      setCompletedSections(prev => new Set([...prev, currentSection]));
      setCurrentSection(currentSection + 1);
      window.scrollTo(0, 0);
    }
  };

  const handlePrevious = () => {
    if (currentSection > 0) {
      setCurrentSection(currentSection - 1);
      window.scrollTo(0, 0);
    }
  };

  const handleSectionClick = (index) => {
    setCurrentSection(index);
    window.scrollTo(0, 0);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      <div className="max-w-7xl mx-auto p-4">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex items-center gap-3 mb-2">
            <BookOpen className="text-blue-600" size={32} />
            <div>
              <h1 className="text-3xl font-bold text-gray-800">FETP-Frontline 3.0</h1>
              <p className="text-gray-600">Workshop 2: Applied Epidemiology Case Study</p>
            </div>
          </div>
        </div>

        <div className="grid lg:grid-cols-4 gap-6">
          {/* Sidebar Navigation */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg shadow-lg p-4 sticky top-4">
              <h3 className="font-semibold mb-3 text-gray-700">Sections</h3>
              <div className="space-y-1">
                {sections.map((section, index) => (
                  <button
                    key={section.id}
                    onClick={() => handleSectionClick(index)}
                    className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${
                      currentSection === index
                        ? 'bg-blue-600 text-white'
                        : completedSections.has(index)
                        ? 'bg-green-50 text-green-700 hover:bg-green-100'
                        : 'hover:bg-gray-100 text-gray-700'
                    }`}
                  >
                    <div className="flex items-center gap-2">
                      {completedSections.has(index) && (
                        <CheckCircle size={14} className="text-green-600" />
                      )}
                      <span className="flex-1">{section.title}</span>
                    </div>
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* Main Content */}
          <div className="lg:col-span-3">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              {sections[currentSection].content}
            </div>

            {/* Navigation Buttons */}
            <div className="flex justify-between items-center">
              <button
                onClick={handlePrevious}
                disabled={currentSection === 0}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-colors ${
                  currentSection === 0
                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                    : 'bg-gray-600 text-white hover:bg-gray-700'
                }`}
              >
                <ChevronLeft size={20} />
                Previous
              </button>

              <span className="text-gray-600 font-medium">
                Section {currentSection + 1} of {sections.length}
              </span>

              <button
                onClick={handleNext}
                disabled={currentSection === sections.length - 1}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-colors ${
                  currentSection === sections.length - 1
                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                Next
                <ChevronRight size={20} />
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

const QuestionBox = ({ number, question, answerId, answers, setAnswers }) => {
  return (
    <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
      <div className="flex items-start gap-2">
        <AlertCircle className="text-yellow-600 mt-1 flex-shrink-0" size={20} />
        <div className="flex-1">
          <h4 className="font-semibold text-yellow-900 mb-2">Question {number}</h4>
          <p className="text-gray-800 mb-3 whitespace-pre-line">{question}</p>
          <textarea
            value={answers[answerId] || ''}
            onChange={(e) => setAnswers({...answers, [answerId]: e.target.value})}
            className="w-full p-3 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
            rows="4"
            placeholder="Type your answer here..."
          />
        </div>
      </div>
    </div>
  );
};

const TimelineEntry = ({ date, event, empty }) => {
  return (
    <div className="flex gap-3">
      <div className="w-24 font-semibold text-blue-900 flex-shrink-0">{date}</div>
      <div className="flex-1">
        {empty ? (
          <div className="bg-yellow-100 p-2 rounded text-sm italic text-gray-600">
            [To be filled based on case information]
          </div>
        ) : (
          <div className="text-gray-700">{event}</div>
        )}
      </div>
    </div>
  );
};

const EpidemicCurve = () => {
  const data = [
    { date: '08', human: 0, cattle: 0 },
    { date: '09', human: 0, cattle: 0 },
    { date: '10', human: 0, cattle: 1 },
    { date: '11', human: 0, cattle: 0 },
    { date: '12', human: 8, cattle: 0 },
    { date: '13', human: 9, cattle: 0 },
    { date: '14', human: 17, cattle: 0 },
    { date: '15', human: 4, cattle: 0 },
    { date: '16', human: 4, cattle: 0 },
    { date: '17', human: 3, cattle: 0 },
    { date: '18', human: 1, cattle: 0 },
    { date: '19', human: 0, cattle: 1 },
    { date: '20', human: 0, cattle: 0 },
    { date: '21', human: 0, cattle: 7 },
    { date: '22', human: 0, cattle: 0 },
    { date: '23', human: 1, cattle: 0 },
    { date: '24', human: 1, cattle: 0 },
    { date: '25', human: 0, cattle: 0 },
    { date: '26', human: 0, cattle: 0 },
    { date: '27', human: 0, cattle: 0 },
    { date: '28', human: 0, cattle: 1 },
    { date: '29', human: 0, cattle: 0 }
  ];

  const maxValue = Math.max(...data.map(d => Math.max(d.human, d.cattle)));

  return (
    <div className="bg-white p-4">
      <div className="flex items-end gap-1" style={{ height: '300px' }}>
        {data.map((d, i) => (
          <div key={i} className="flex-1 flex flex-col justify-end items-center gap-1">
            {d.human > 0 && (
              <div
                className="w-full bg-red-500 hover:bg-red-600 transition-colors cursor-pointer"
                style={{ height: `${(d.human / maxValue) * 250}px` }}
                title={`${d.human} human cases`}
              />
            )}
            {d.cattle > 0 && (
              <div
                className="w-full bg-gray-400 hover:bg-gray-500 transition-colors cursor-pointer"
                style={{
                  height: `${(d.cattle / maxValue) * 250}px`,
                  backgroundImage: 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.1) 5px, rgba(0,0,0,0.1) 10px)'
                }}
                title={`${d.cattle} cattle deaths`}
              />
            )}
            <span className="text-xs text-gray-600 mt-1">{d.date}</span>
          </div>
        ))}
      </div>
      <div className="mt-4 flex gap-4 justify-center text-sm">
        <div className="flex items-center gap-2">
          <div className="w-4 h-4 bg-red-500"></div>
          <span>Human cases</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-4 h-4 bg-gray-400" style={{ backgroundImage: 'repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 4px)' }}></div>
          <span>Cattle deaths</span>
        </div>
      </div>
    </div>
  );
};

const AttackRateTable = ({ title, rows, answerId, answers, setAnswers }) => {
  const [tableData, setTableData] = useState(rows);

  const handleInputChange = (index, field, value) => {
    const newData = [...tableData];
    newData[index][field] = value;
    setTableData(newData);
    setAnswers({...answers, [answerId]: newData});
  };

  return (
    <div className="bg-white border border-gray-300 rounded-lg p-4">
      <h4 className="font-semibold mb-3">{title}</h4>
      <table className="w-full text-sm">
        <thead className="bg-gray-100">
          <tr>
            <th className="p-2 text-left">Group</th>
            <th className="p-2 text-center">Number of cases</th>
            <th className="p-2 text-center">Population</th>
            <th className="p-2 text-center">Attack rate (%)</th>
          </tr>
        </thead>
        <tbody>
          {tableData.map((row, index) => (
            <tr key={index} className="border-t">
              <td className="p-2">{row.label}</td>
              <td className="p-2">
                <input
                  type="number"
                  value={row.cases}
                  onChange={(e) => handleInputChange(index, 'cases', e.target.value)}
                  className="w-full p-1 border rounded text-center"
                  placeholder="?"
                />
              </td>
              <td className="p-2 text-center">{row.population}</td>
              <td className="p-2">
                <input
                  type="number"
                  step="0.1"
                  value={row.rate}
                  onChange={(e) => handleInputChange(index, 'rate', e.target.value)}
                  className="w-full p-1 border rounded text-center"
                  placeholder="?"
                />
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

const ExposureAttackRateTable = ({ answerId, answers, setAnswers }) => {
  const exposures = [
    { label: 'Carried dead cow and/or butchered parts', cases: 21, nonCase: 19, total: 40 },
    { label: 'Skinned cow', cases: 8, nonCase: 2, total: 10 },
    { label: 'Carried skin from dead animal', cases: 7, nonCase: 1, total: 8 },
    { label: 'Cut/butchered cow', cases: 9, nonCase: 1, total: 10 },
    { label: 'Cleaned waste from butchering site', cases: 8, nonCase: 2, total: 10 },
    { label: 'Removed internal organs from dead cow', cases: 7, nonCase: 3, total: 10 },
    { label: 'Prepared meat for cooking', cases: 12, nonCase: 24, total: 36 }
  ];

  const [rates, setRates] = useState({});

  const handleRateChange = (index, value) => {
    const newRates = {...rates, [index]: value};
    setRates(newRates);
    setAnswers({...answers, [answerId]: newRates});
  };

  return (
    <div className="bg-white border border-gray-300 rounded-lg p-4">
      <h4 className="font-semibold mb-3">Exposure-specific attack rates (cutaneous anthrax)</h4>
      <table className="w-full text-sm">
        <thead className="bg-gray-100">
          <tr>
            <th className="p-2 text-left">Possible exposure</th>
            <th className="p-2 text-center">Case</th>
            <th className="p-2 text-center">Non-case</th>
            <th className="p-2 text-center">Total</th>
            <th className="p-2 text-center">Attack rate (%)</th>
          </tr>
        </thead>
        <tbody>
          {exposures.map((exp, index) => (
            <tr key={index} className="border-t">
              <td className="p-2">{exp.label}</td>
              <td className="p-2 text-center">{exp.cases}</td>
              <td className="p-2 text-center">{exp.nonCase}</td>
              <td className="p-2 text-center">{exp.total}</td>
              <td className="p-2">
                <input
                  type="number"
                  step="0.1"
                  value={rates[index] || ''}
                  onChange={(e) => handleRateChange(index, e.target.value)}
                  className="w-full p-1 border rounded text-center"
                  placeholder="Calculate"
                />
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

const LineListData = () => {
  return (
    <div className="text-xs">
      <p className="font-semibold mb-2">Sample of line list data (first 20 cases):</p>
      <table className="w-full">
        <thead className="bg-gray-100">
          <tr>
            <th className="p-1">Sex</th>
            <th className="p-1">Age</th>
            <th className="p-1">Type</th>
            <th className="p-1">Onset</th>
          </tr>
        </thead>
        <tbody>
          <tr><td className="p-1">F</td><td className="p-1">1</td><td className="p-1">Cutan-GI</td><td className="p-1">15/4</td></tr>
          <tr><td className="p-1">F</td><td className="p-1">1</td><td className="p-1">Cutan-Only</td><td className="p-1">20/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">2</td><td className="p-1">GI-Only</td><td className="p-1">16/4</td></tr>
          <tr><td className="p-1">F</td><td className="p-1">3</td><td className="p-1">Cutan-GI</td><td className="p-1">14/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">3</td><td className="p-1">Cutan-GI</td><td className="p-1">17/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">3</td><td className="p-1">GI-Only</td><td className="p-1">19/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">3</td><td className="p-1">GI-Only</td><td className="p-1">13/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">4</td><td className="p-1">Cutan-GI</td><td className="p-1">15/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">4</td><td className="p-1">GI-Only</td><td className="p-1">13/4</td></tr>
          <tr><td className="p-1">M</td><td className="p-1">5</td><td className="p-1">Cutan-GI</td><td className="p-1">14/4</td></tr>
        </tbody>
      </table>
      <p className="mt-2 italic text-gray-600">Full line list available in PDF appendix (48 total cases)</p>
    </div>
  );
};

export default AnthraxCaseStudy;
